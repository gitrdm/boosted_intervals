---
title: "Working with Unit-Aware Intervals"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Working with Unit-Aware Intervals}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(boostedintervals)
library(units)
```

## Motivation

Intervals capture measurement uncertainty by storing lower and upper bounds.
`boostedintervals` wires Boost.Interval into R while preserving `units`
metadata, so physical dimensions remain attached throughout your
calculations.

## Constructing unit-aware intervals

Use `units_interval()` to build interval vectors. Bounds can be supplied as plain
numerics with an explicit unit, or as `units` vectors.

```{r}
length_interval <- units_interval(0, 5, unit = "m")
length_interval

acceleration <- units_interval(
  set_units(c(9.5, 9.7), "m/s^2"),
  set_units(c(9.8, 9.81), "m/s^2")
)
acceleration
```

The helper `as_units_interval()` coercion wraps scalars, numeric vectors, and
existing `units` objects:

```{r}
as_units_interval(3, unit = "cm")
as_units_interval(set_units(1:3, "s"))
```

## Arithmetic and unit propagation

Standard arithmetic operators reuse Boost's interval arithmetic while keeping
unit algebra intact.

```{r}
width_a <- units_interval(set_units(2, "m"), set_units(3, "m"))
width_b <- units_interval(set_units(4, "m"), set_units(5, "m"))

sum_interval <- width_a + width_b
sum_interval
units(sum_interval$lower)

time_span <- units_interval(1, 2, unit = "s")
speed_interval <- sum_interval / time_span
speed_interval
units(speed_interval$lower)
```

Unary transformations preserve unit semantics as well. Absolute value keeps
the original units while square roots require squared quantities and return
the principal root expressed in the corresponding base unit. Integer powers are
available through `^` as long as the exponent is whole and, for negative powers,
the interval does not span zero.

```{r}
abs(width_a - width_b)

area_interval <- units_interval(set_units(25, "m^2"), set_units(36, "m^2"))
sqrt(area_interval)

volume_interval <- width_a ^ 3
volume_interval
units(volume_interval$lower)

angles <- units_interval(0, pi / 6, unit = "rad")
sin(angles)
cos(angles)

sin(convert_units(angles, "degree"))

growth <- units_interval(0, 0.25, unit = "1")
exp(growth)
log(units_interval(1, 5, unit = "1"))
```

Exponentials and logarithms require dimensionless intervals. Trigonometric
functions accept angles expressed in radians or any units convertible to
radians, converting behind the scenes before evaluating the function. If
inputs carry incompatible units (for instance, meters), an informative error
is raised to help catch inconsistent analyses early.

Comparison operators recycle operands, align units, and return logical vectors.

```{r}
width_a <= convert_units(width_b, "cm")
width_a == width_b
```

## Interval predicates and set operations

Containment queries accept points, `units` vectors, or other intervals.

```{r}
contains(sum_interval, set_units(6, "m"))
contains(sum_interval, sum_interval / 2)
```

Use `overlaps()` to test intersections and `interval_intersection()` /
`interval_union()` to build new intervals.

```{r}
other_width <- units_interval(set_units(3, "m"), set_units(6, "m"))

overlaps(sum_interval, other_width)
intersection <- interval_intersection(sum_interval, other_width)
intersection

hull <- interval_union(sum_interval, other_width)
hull
```

## Visualization-ready summaries

Utilities such as `width()` and `midpoint()` return `units` vectors that can be
fed directly into plotting pipelines or summary tables.

```{r}
width(sum_interval)
midpoint(other_width)
```

## Next steps

The interval building blocks shown here integrate smoothly with tidy workflows:
wrap results in data frames, summarize with dplyr, or visualise with ggplot2
using the lower/upper bounds. For more advanced scenarios—such as repeated
operations over large vectors—consider caching intervals and reusing them across
calculations to minimize repeated unit conversions.
